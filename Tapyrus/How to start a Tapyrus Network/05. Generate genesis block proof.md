# 05. Generate genesis block proof

Tapyrusネットワークをやりとりされる全てのブロックはTSNによる署名が必要です。これはジェネシスブロックについても同じです。この章ではジェネシスブロックをTSNにより署名していきます。

また、前章によりジェネシスブロックの16進数文字列があることが前提です。まだ持っていない場合は前章を参照してください。

## 1. Generate Block VSS

まず、各SignerでブロックVSSを生成します。集約公開鍵を生成した際のノードVSSの手順と同じです。

```bash
$ tapyrus-setup createblockvss \
  --public-key=<public_key[1]> --public-key=<public_key[2]> ... --public-key=<public_key[n]> \
  --private-key=<private_key[i]> \
  --threshold=<t>
```

- `<public_key[j]>` は各Signerの公開鍵
- `<private_key[i]>` は自身の秘密鍵
- `<t>` はブロック署名に必要なSignerの最小数、つまり閾値

返答は以下です。

```
<public_key[1]>: <block_vss[i, 1]>,
<public_key[2]>: <block_vss[i, 2]>,
...
<public_key[n]>: <block_vss[i, n]>
```

Signerは生成したブロックVSSを各Signerに共有します。

## 2. Sign the genesis block locally

各Signerは他のSignerが生成したブロックVSSを受け取り、ローカル署名を生成します。

```bash
$ tapyrus-setup sign \
  --block-vss=<block_vss[1, i]> --block-vss=<block_vss[2, i]> ... --block-vss=<block_vss[n, i]> \
  --aggregated-public-key=<aggregated_public_key> \ 
  --node-secret-share=<node_secret_share[i]> \
  --private-key=<private_key[i]> \
  --block=<block> \
  --threshold=<t>
```

- `<block_vss[]>` は共有された各SignerのブロックVSS
- `<aggregate_public_key>` はTSNの集約公開鍵
- `<node_secret_share[i]>` は自身のNSS
- `<private_key>` は自身の秘密鍵
- `<block>` は未署名のジェネシスブロックの16進数文字列
- `<t>` は閾値

返答は以下です。

```
<local_sig[i]>
```

自身のローカル署名が返ってくるのでこれも他のSignerと共有します。

また、ローカル署名は公開値です。

### 3. Compute the signature of the genesis block

各Signerのローカル署名を収集したら、`tapyrus-setup computesig` を用いてジェネシスブロックの署名を生成します。

```bash
$ tapyrus-setup computesig \
  --sig=<local_sig[1]> --sig=<local_sig[2]> ... --sig=<local_sig[n]> \
  --private-key=<private_key[i]> \
  --block=<block> \
  --block-vss=<block_vss[1, i]> --block-vss=<block_vss[2, i]> ... --block-vss=<block_vss[n, i]> \
  --node-vss=<node_vss[1, i]> --node-vss=<node_vss[2, i]> ... --node-vss=<node_vss[n, i]> \
  --aggregated-public-key=<aggregated_public_key> \
  --node-secret-share=<node_secret_share[i]> \
  --threshold=<t>
```

- `<local_sig>` は共有された各Signerのローカル署名
- 他は先述と同様

返答は以下です。

``` 
<block_with_signature>
```

署名されたジェネシスブロックが返ってきます。

### 4. Create genesis.networkid file

genesis.`networkid` という名前のファイルを作成し、`<block_with_signature>` で埋めます。

